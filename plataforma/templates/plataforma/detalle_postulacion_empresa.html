{% extends "plataforma/base.html" %}

{% block content %}
<div class="container" style="padding: 40px 20px; max-width: 900px;">
    <h1 style="color: #2d5016; margin-bottom: 40px;">üìå Detalles de Postulaci√≥n - Empresa</h1>

    <!-- Informaci√≥n principal -->
    <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            <div>
                <h3 style="color: #2d5016; margin-bottom: 15px; border-bottom: 2px solid #4CAF50; padding-bottom: 10px;">üë§ Aprendiz</h3>
                <div style="margin-bottom: 15px;">
                    <div style="color: #999; font-size: 12px; text-transform: uppercase;">Nombre</div>
                    <div style="font-size: 18px; font-weight: bold; color: #333;">{{ postulacion.aprendiz.nombre }}</div>
                </div>
                <div style="margin-bottom: 15px;">
                    <div style="color: #999; font-size: 12px; text-transform: uppercase;">Email</div>
                    <div style="font-size: 14px; color: #666;">{{ postulacion.aprendiz.correo }}</div>
                </div>
                <div style="margin-bottom: 15px;">
                    <div style="color: #999; font-size: 12px; text-transform: uppercase;">Tel√©fono</div>
                    <div style="font-size: 14px; color: #666;">{{ postulacion.aprendiz.telefono|default:"No registrado" }}</div>
                </div>
            </div>
            <div>
                <h3 style="color: #2d5016; margin-bottom: 15px; border-bottom: 2px solid #2196F3; padding-bottom: 10px;">üìä Estado de Postulaci√≥n</h3>
                <div style="margin-bottom: 20px;">
                    <div style="color: #999; font-size: 12px; text-transform: uppercase; margin-bottom: 5px;">Estado Actual</div>
                    {% if postulacion.estado == 'PENDIENTE' %}
                        <span style="background: #FF9800; color: white; padding: 10px 15px; border-radius: 5px; font-weight: bold; font-size: 14px;">‚è≥ Pendiente</span>
                    {% elif postulacion.estado == 'PROCESO_SELECCION_ABIERTO' %}
                        <span style="background: #4CAF50; color: white; padding: 10px 15px; border-radius: 5px; font-weight: bold; font-size: 14px;">‚úì Proceso Abierto</span>
                    {% elif postulacion.estado == 'CONTRATO_NO_REGISTRADO' %}
                        <span style="background: #f44336; color: white; padding: 10px 15px; border-radius: 5px; font-weight: bold; font-size: 14px;">‚ö† Contrato No Registrado</span>
                    {% elif postulacion.estado == 'CONTRATADO' %}
                        <span style="background: #2E7D32; color: white; padding: 10px 15px; border-radius: 5px; font-weight: bold; font-size: 14px;">üéâ Contratado</span>
                    {% elif postulacion.estado == 'DISPONIBLE' %}
                    {% elif not postulacion.estado or postulacion.estado|length == 0 or postulacion.estado == 'DISPONIBLE' %}
                        <span style="background: #2196F3; color: white; padding: 10px 15px; border-radius: 5px; font-weight: bold; font-size: 14px;">‚Üí Disponible</span>
                    {% endif %}
                </div>
                <div style="margin-bottom: 15px;">
                    <div style="color: #999; font-size: 12px; text-transform: uppercase;">Fecha Postulaci√≥n</div>
                    <div style="font-size: 14px; color: #666;">{{ postulacion.fecha_postulacion|date:"d/m/Y H:i" }}</div>
                </div>
                <div>
                    <div style="color: #999; font-size: 12px; text-transform: uppercase; margin-bottom: 8px;">Respuestas Recibidas</div>
                    <div style="font-size: 13px; color: #666;">
                        {% if postulacion.aprendiz_dio_respuesta %}
                            <div style="color: #4CAF50;">‚úì Aprendiz respondi√≥</div>
                        {% else %}
                            <div style="color: #f44336;">‚úó Aprendiz no respondi√≥</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Observaci√≥n del aprendiz -->
    <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
        <h3 style="color: #2d5016; margin-bottom: 20px; border-bottom: 2px solid #4CAF50; padding-bottom: 10px;">üí¨ Observaci√≥n del Aprendiz</h3>
        {% if postulacion.observacion_aprendiz %}
            <div style="background: #f5f5f5; padding: 20px; border-left: 4px solid #4CAF50; border-radius: 5px;">
                <p style="color: #333; margin: 0; line-height: 1.6;">{{ postulacion.observacion_aprendiz }}</p>
            </div>
        {% else %}
            <p style="color: #999; font-style: italic;">El aprendiz a√∫n no ha dejado observaciones.</p>
        {% endif %}
    </div>

    <!-- Formulario para cambiar estado y agregar observaci√≥n -->
    {% if postulacion.estado == 'PENDIENTE' or postulacion.estado == 'PROCESO_SELECCION_ABIERTO' or postulacion.estado == 'CONTRATO_NO_REGISTRADO' %}
        <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
            <h3 style="color: #2d5016; margin-bottom: 20px; border-bottom: 2px solid #2196F3; padding-bottom: 10px;">‚úèÔ∏è Tomar Decisi√≥n</h3>
            
            {% if postulacion.observacion_empresa %}
                <div style="background: #E3F2FD; padding: 20px; border-left: 4px solid #2196F3; border-radius: 5px; margin-bottom: 20px;">
                    <div style="color: #999; font-size: 12px; text-transform: uppercase; margin-bottom: 8px;">Tu observaci√≥n anterior:</div>
                    <p style="color: #333; margin: 0; line-height: 1.6;">{{ postulacion.observacion_empresa }}</p>
                </div>
            {% endif %}

            <form method="POST" style="display: grid; gap: 15px;">
                {% csrf_token %}
                <textarea name="observacion" placeholder="Escribe tu observaci√≥n, comentarios o razones..." style="width: 100%; min-height: 120px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; font-family: Arial; font-size: 14px; resize: vertical;">{{ postulacion.observacion_empresa }}</textarea>
                
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    {% if postulacion.estado == 'PENDIENTE' %}
                    <button type="submit" name="accion" value="seleccionar" style="background: #4CAF50; color: white; padding: 12px 20px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 14px;">
                        ‚úì Aceptar (Proceso Abierto)
                    </button>
                    <button type="submit" name="accion" value="rechazar" style="background: #f44336; color: white; padding: 12px 20px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 14px;">
                        ‚úó No Pasa (Contrato No Registrado)
                    </button>
                    {% endif %}

                    {% if postulacion.estado == 'PROCESO_SELECCION_ABIERTO' %}
                    <button type="submit" name="accion" value="contratar" style="background: #2E7D32; color: white; padding: 12px 20px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 14px;">
                        üéâ Contratar
                    </button>
                    {% endif %}
                </div>
                
                <button type="submit" name="accion" value="observacion" style="background: #2196F3; color: white; padding: 12px 20px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 14px;">
                    üíæ Guardar Observaci√≥n
                </button>
                
                <p style="color: #999; font-size: 12px; margin: 0;">
                    ‚ìò Una vez que guardes tu respuesta y el aprendiz tambi√©n responda, el estado cambiar√° a "Disponible".
                </p>
            </form>
        </div>
    {% endif %}

    <!-- Historial de cambios -->
    <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
        <h3 style="color: #2d5016; margin-bottom: 20px; border-bottom: 2px solid #FF9800; padding-bottom: 10px;">üìú Historial de Cambios</h3>
        
        {% if historial %}
            <div style="display: flex; flex-direction: column; gap: 15px;">
                {% for evento in historial %}
                    <div style="padding: 15px; background: #f9f9f9; border-left: 4px solid #FF9800; border-radius: 5px;">
                        <div style="color: #666; font-size: 12px; margin-bottom: 5px;">{{ evento.fecha_cambio|date:"d/m/Y H:i" }}</div>
                        <div style="color: #333; font-weight: bold; margin-bottom: 8px;">
                            {% if evento.estado_anterior %}
                                {{ evento.estado_anterior }} ‚Üí {{ evento.estado_nuevo }}
                            {% else %}
                                Postulaci√≥n creada
                            {% endif %}
                        </div>
                        {% if evento.comentario %}
                            <p style="color: #666; margin: 0; font-size: 13px; line-height: 1.5;">{{ evento.comentario }}</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="color: #999; font-style: italic;">Sin cambios registrados.</p>
        {% endif %}
    </div>

    <div style="text-align: center; margin-top: 40px;">
        <a href="{% url 'postulaciones_recibidas' %}" style="padding: 12px 30px; background-color: #4CAF50; color: white; text-decoration: none; border-radius: 5px; font-weight: bold;">
            ‚Üê Volver a Postulaciones
        </a>
    </div>
</div>
{% endblock %}
