{% extends "plataforma/base.html" %}

{% block title %}Empresas - SGVA{% endblock %}

{% block content %}
<div class="page-container">
    <!-- Header con estadísticas -->
    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-building"></i> Empresas
        </h1>
        <p class="page-subtitle">Gestión de empresas del sistema de vinculación laboral</p>
    </div>

    <!-- Estadísticas -->
    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-number">
                {% if mostrar_todos %}
                    {{ empresas|length }}
                {% else %}
                    {{ empresas.paginator.count }}
                {% endif %}
            </div>
            <div class="stat-label">Total Empresas</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">
                {% if mostrar_todos %}
                    {{ empresas|length }}
                {% else %}
                    {{ empresas.paginator.count }}
                {% endif %}
            </div>
            <div class="stat-label">Activas</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">12</div>
            <div class="stat-label">Con Vacantes</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">8</div>
            <div class="stat-label">Proceso Selección</div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="filters-section">
        <h2 class="filters-title">
            <i class="fas fa-filter"></i> Filtros de Búsqueda
        </h2>
        <form method="GET" class="filters-grid">
            <div class="form-group">
                <label for="q">Buscar:</label>
                <input type="text" id="q" name="q" class="form-control" 
                       placeholder="Nombre o NIT..." 
                       value="{{ busqueda|default:'' }}">
            </div>
            
            <div class="form-group">
                <label for="estado">Estado:</label>
                <select id="estado" name="estado" class="form-control">
                    <option value="">Todos los estados</option>
                    {% for estado in estados %}
                    <option value="{{ estado.0 }}" {% if estado_seleccionado == estado.0 %}selected{% endif %}>
                        {{ estado.1 }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="sector">Sector:</label>
                <input type="text" id="sector" name="sector" class="form-control" 
                       placeholder="Sector económico..." 
                       value="{{ sector_filtro|default:'' }}">
            </div>
            
            <div class="form-group">
                <label for="ciudad">Ciudad:</label>
                <input type="text" id="ciudad" name="ciudad" class="form-control" 
                       placeholder="Ciudad..." 
                       value="{{ ciudad_filtro|default:'' }}">
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i> Buscar
                </button>
                <a href="{% url 'lista_empresas' %}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Limpiar
                </a>
                {% if not mostrar_todos %}
                <a href="?todos=true{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.estado %}&estado={{ request.GET.estado }}{% endif %}{% if request.GET.sector %}&sector={{ request.GET.sector }}{% endif %}{% if request.GET.ciudad %}&ciudad={{ request.GET.ciudad }}{% endif %}" class="btn btn-info">
                    <i class="fas fa-list"></i> Mostrar Todos
                </a>
                {% else %}
                <a href="{% url 'lista_empresas' %}{% if request.GET.q %}?q={{ request.GET.q }}{% endif %}{% if request.GET.estado %}?estado={{ request.GET.estado }}{% endif %}{% if request.GET.sector %}?sector={{ request.GET.sector }}{% endif %}{% if request.GET.ciudad %}?ciudad={{ request.GET.ciudad }}{% endif %}" class="btn btn-warning">
                    <i class="fas fa-th-list"></i> Paginar
                </a>
                {% endif %}
            </div>
        </form>
    </div>

    <!-- Tabla de empresas -->
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th><i class="fas fa-building"></i> Empresa</th>
                    <th><i class="fas fa-id-card"></i> NIT</th>
                    <th><i class="fas fa-map-marker-alt"></i> Ubicación</th>
                    <th><i class="fas fa-industry"></i> Sector</th>
                    <th><i class="fas fa-info-circle"></i> Estado</th>
                    <th><i class="fas fa-users"></i> Aprendices</th>
                    <th><i class="fas fa-cog"></i> Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for empresa in empresas %}
                <tr>
                    <td>
                        <strong>{{ empresa.nombre }}</strong>
                        {% if empresa.sitio_web %}
                        <br><small class="text-muted">
                            <i class="fas fa-globe"></i> <a href="{{ empresa.sitio_web }}" target="_blank" style="color: #006837;">{{ empresa.sitio_web }}</a>
                        </small>
                        {% endif %}
                    </td>
                    <td>{{ empresa.nit }}</td>
                    <td>
                        {{ empresa.ciudad|default:"-" }}
                        {% if empresa.direccion %}
                        <br><small class="text-muted">{{ empresa.direccion }}</small>
                        {% endif %}
                    </td>
                    <td>{{ empresa.sector_economico|default:"-" }}</td>
                    <td>
                        {% if empresa.estado == "ACTIVA" %}
                            <span class="badge badge-success">
                                <i class="fas fa-check-circle"></i> {{ empresa.get_estado_display }}
                            </span>
                        {% elif empresa.estado == "INACTIVA" %}
                            <span class="badge badge-danger">
                                <i class="fas fa-times-circle"></i> {{ empresa.get_estado_display }}
                            </span>
                        {% elif empresa.estado == "PENDIENTE" %}
                            <span class="badge badge-warning">
                                <i class="fas fa-clock"></i> {{ empresa.get_estado_display }}
                            </span>
                        {% else %}
                            <span class="badge badge-info">
                                <i class="fas fa-info-circle"></i> {{ empresa.get_estado_display }}
                            </span>
                        {% endif %}
                    </td>
                    <td>
                        <span style="font-weight: 700; color: #006837;">
                            {{ empresa.numero_aprendices|default:0 }}
                        </span>
                    </td>
                    <td>
                        <a href="{% url 'detalle_empresa' empresa.id %}" class="btn btn-sm btn-primary">
                            <i class="fas fa-eye"></i> Ver
                        </a>
                        <a href="{% url 'editar_empresa' empresa.id %}" class="btn btn-sm btn-warning">
                            <i class="fas fa-edit"></i> Editar
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="empty-state">
                        <i class="fas fa-search"></i>
                        <p>No se encontraron empresas con los filtros seleccionados.</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Paginación -->
    {% if not mostrar_todos and empresas.has_other_pages %}
    <div class="pagination">
        {% if empresas.has_previous %}
            <a href="?page={{ empresas.previous_page_number }}{% if busqueda %}&q={{ busqueda }}{% endif %}{% if estado_seleccionado %}&estado={{ estado_seleccionado }}{% endif %}">
                <i class="fas fa-chevron-left"></i>
            </a>
        {% endif %}
        
        {% for num in empresas.paginator.page_range %}
            {% if empresas.number == num %}
                <span class="current">{{ num }}</span>
            {% elif num > empresas.number|add:'-3' and num < empresas.number|add:'3' %}
                <a href="?page={{ num }}{% if busqueda %}&q={{ busqueda }}{% endif %}{% if estado_seleccionado %}&estado={{ estado_seleccionado }}{% endif %}">{{ num }}</a>
            {% endif %}
        {% endfor %}
        
        {% if empresas.has_next %}
            <a href="?page={{ empresas.next_page_number }}{% if busqueda %}&q={{ busqueda }}{% endif %}{% if estado_seleccionado %}&estado={{ estado_seleccionado }}{% endif %}">
                <i class="fas fa-chevron-right"></i>
            </a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
