{% extends "plataforma/base.html" %}

{% block title %}Importar Datos - SGVA{% endblock %}

{% block content %}
<div class="page-container">
    <!-- Header -->
    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-file-import"></i> Importar Datos
        </h1>
        <p class="page-subtitle">Importación masiva de aprendices y empresas desde archivos Excel</p>
    </div>

    <!-- Sección de Importación -->
    <div class="info-card">
        <div class="card-header">
            <div class="card-icon">
                <i class="fas fa-upload"></i>
            </div>
            <h3 class="card-title">Seleccionar Archivo</h3>
        </div>
        
        <form method="post" enctype="multipart/form-data" id="importForm">
            {% csrf_token %}
            <div class="filters-grid">
                <div class="form-group">
                    <label for="tipo_importacion">Tipo de Importación:</label>
                    <select name="tipo_importacion" id="tipo_importacion" class="form-control" required>
                        <option value="">Seleccione un tipo...</option>
                        <option value="aprendices">Aprendices</option>
                        <option value="empresas">Empresas</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="archivo">Archivo Excel:</label>
                    <input type="file" name="archivo" id="archivo" class="form-control" accept=".xlsx,.xls" required>
                    <small class="text-muted">Formatos permitidos: .xlsx, .xls</small>
                </div>
                
                <div class="form-group">
                    <label>&nbsp;</label>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-file-import"></i> Importar Datos
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Resultados de Importación -->
    {% if resumen %}
    <div class="info-card">
        <div class="card-header">
            <div class="card-icon">
                <i class="fas fa-chart-bar"></i>
            </div>
            <h3 class="card-title">Resultados de la Importación</h3>
        </div>
        
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-number">{{ resumen.total_registros }}</div>
                <div class="stat-label">Total Registros</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ resumen.registros_exitosos }}</div>
                <div class="stat-label">Importados Correctamente</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ resumen.registros_omitidos }}</div>
                <div class="stat-label">Omitidos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ resumen.registros_con_error }}</div>
                <div class="stat-label">Con Errores</div>
            </div>
        </div>
        
        {% if resumen.registros_con_error > 0 %}
        <div class="alert alert-danger">
            <h4><i class="fas fa-exclamation-triangle"></i> Errores Detectados</h4>
            <p>Se encontraron {{ resumen.registros_con_error }} registros con errores. Por favor revise el archivo y corrija los datos.</p>
        </div>
        {% endif %}
        
        {% if resumen.registros_exitosos > 0 %}
        <div class="alert alert-success">
            <h4><i class="fas fa-check-circle"></i> Importación Exitosa</h4>
            <p>Se importaron correctamente {{ resumen.registros_exitosos }} registros.</p>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Guías de Importación -->
    <div class="content-grid">
        <div class="info-card">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-user-graduate"></i>
                </div>
                <h3 class="card-title">Importar Aprendices</h3>
            </div>
            
            <div class="info-item">
                <div class="info-label">Formato del Archivo</div>
                <div class="info-value">Excel (.xlsx, .xls)</div>
            </div>
            
            <div class="info-item">
                <div class="info-label">Columnas Requeridas</div>
                <div class="info-value">
                    <ul style="margin: 0; padding-left: 1.5rem;">
                        <li>nombre</li>
                        <li>tipo_documento</li>
                        <li>numero_documento</li>
                        <li>correo</li>
                        <li>telefono</li>
                        <li>ficha</li>
                        <li>programa_formacion</li>
                    </ul>
                </div>
            </div>
            
            <div class="info-item">
                <div class="info-label">Tipos de Documento</div>
                <div class="info-value">
                    <ul style="margin: 0; padding-left: 1.5rem;">
                        <li>CC - Cédula de Ciudadanía</li>
                        <li>TI - Tarjeta de Identidad</li>
                        <li>CE - Cédula de Extranjería</li>
                        <li>PA - Pasaporte</li>
                    </ul>
                </div>
            </div>
            
            <div class="observacion-box">
                <div class="info-label">Nota Importante</div>
                <div class="info-value">
                    Los correos electrónicos deben ser únicos. Si un aprendiz con el mismo correo ya existe, se actualizarán sus datos.
                </div>
            </div>
        </div>
        
        <div class="info-card">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-building"></i>
                </div>
                <h3 class="card-title">Importar Empresas</h3>
            </div>
            
            <div class="info-item">
                <div class="info-label">Formato del Archivo</div>
                <div class="info-value">Excel (.xlsx, .xls)</div>
            </div>
            
            <div class="info-item">
                <div class="info-label">Columnas Requeridas</div>
                <div class="info-value">
                    <ul style="margin: 0; padding-left: 1.5rem;">
                        <li>nombre</li>
                        <li>nit</li>
                        <li>direccion</li>
                        <li>ciudad</li>
                        <li>telefono</li>
                        <li>correo_contacto</li>
                        <li>sector_economico</li>
                    </ul>
                </div>
            </div>
            
            <div class="info-item">
                <div class="info-label">Estados Válidos</div>
                <div class="info-value">
                    <ul style="margin: 0; padding-left: 1.5rem;">
                        <li>ACTIVA</li>
                        <li>INACTIVA</li>
                        <li>PENDIENTE</li>
                    </ul>
                </div>
            </div>
            
            <div class="observacion-box">
                <div class="info-label">Nota Importante</div>
                <div class="info-value">
                    Los NIT deben ser únicos. Si una empresa con el mismo NIT ya existe, se actualizarán sus datos.
                </div>
            </div>
        </div>
    </div>

    <!-- Plantillas de Ejemplo -->
    <div class="info-card">
        <div class="card-header">
            <div class="card-icon">
                <i class="fas fa-download"></i>
            </div>
            <h3 class="card-title">Plantillas de Ejemplo</h3>
        </div>
        
        <div class="content-grid">
            <div class="import-card">
                <div class="import-icon">
                    <i class="fas fa-file-excel"></i>
                </div>
                <h4>Plantilla Aprendices</h4>
                <p>Formato estándar para importar aprendices</p>
                <button class="btn btn-success">
                    <i class="fas fa-download"></i> Descargar Plantilla
                </button>
            </div>
            
            <div class="import-card">
                <div class="import-icon">
                    <i class="fas fa-file-excel"></i>
                </div>
                <h4>Plantilla Empresas</h4>
                <p>Formato estándar para importar empresas</p>
                <button class="btn btn-success">
                    <i class="fas fa-download"></i> Descargar Plantilla
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('importForm').addEventListener('submit', function(e) {
    const submitBtn = e.target.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Importando...';
    
    // Mostrar indicador de carga
    const loadingDiv = document.createElement('div');
    loadingDiv.className = 'loading';
    loadingDiv.innerHTML = '<div class="spinner"></div><p>Procesando archivo, por favor espere...</p>';
    e.target.appendChild(loadingDiv);
});
</script>
{% endblock %}
